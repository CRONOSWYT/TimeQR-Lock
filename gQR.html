<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de QR cifrado - TimeQR Lock</title>

  <!-- Librerías externas necesarias -->
  <!-- CryptoJS sirve para cifrar los datos -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <!-- QRCode es una librería para generar el código QR -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <style>
    /* Esto le da estilo al fondo y al texto */
    body {
      background-color: #050050; /* azul clarito */
      color: #333333; /* texto oscuro */
      font-family: Arial, sans-serif;
      padding: 20px;
      text-align: center;
    }

    /* Título principal */
    h1 {
      color: #00796b; /* verde azulado */
    }

    /* Etiquetas de los formularios */
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }

    /* Campos de texto */
    input {
      padding: 10px;
      width: 250px;
      border-radius: 5px;
      border: 1px solid #999;
      margin-top: 5px;
    }

    /* Botón para generar el QR */
    button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #00796b;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    /* Estilo del QR generado */
    #qrcode {
      margin-top: 20px;
      background-color: white;
      padding: 10px;
      display: inline-block;
    }

    /* Texto con el contenido cifrado */
    #qrdata {
      margin-top: 10px;
      font-size: 12px;
      color: #555;
      word-break: break-all;
      max-width: 90vw;
      margin-left: auto;
      margin-right: auto;
    }

    /* Botón para descargar el QR */
    #descargar {
      margin-top: 10px;
      display: none;
      background-color: #4caf50;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>

  <!-- Esto aparece al abrir la página, pide una contraseña para proteger el generador -->
  <script>
    const pass = prompt("Ingresa la contraseña para usar el generador:");
    if (pass !== "w") {
      alert("Contraseña incorrecta. No puedes entrar.");
      window.location.href = "https://www.google.com";
    }
  </script>
<center>
  <!-- Título principal -->
  <h1>Generador de QR - TimeQR Lock</h1>

  <!-- Formulario donde se pone el nombre del estudiante -->
  <label for="nombre">Nombre del estudiante:</label>
  <input type="text" id="nombre" placeholder="Ejemplo: Juan Pérez">

  <!-- Formulario donde se pone el grado -->
  <label for="grado">Grado / Grupo:</label>
  <input type="number" id="grado" placeholder="Ejemplo: 10.4">
<br><br>
  <!-- Botón para generar el código QR -->
  <button onclick="generarQR()">Generar QR</button>
</center>
<br>
  <!-- Aquí aparecerá el código QR -->
  <div id="qrcode"></div>

  <!-- Aquí se muestra el texto cifrado (opcional) -->
  <p id="qrdata"></p>

  <!-- Botón para descargar la imagen del QR -->
  <button id="descargar" onclick="descargarQR()">Descargar QR como imagen</button>

  <script>
    // Esta es la clave secreta usada para cifrar el contenido del QR
    const CLAVE_SECRETA = 'https://www.youtube.com/@WorldTimeOficial';

    // Función para cifrar los datos del estudiante
    function cifrarDatos(datos) {
      const textoPlano = JSON.stringify(datos); // Convertimos a texto normal
      const textoCifrado = CryptoJS.AES.encrypt(textoPlano, CLAVE_SECRETA).toString();
      return textoCifrado; // Retornamos el texto cifrado
    }

    // Esta función genera el QR al presionar el botón
    function generarQR() {
      const nombre = document.getElementById('nombre').value.trim();
      const grado = document.getElementById('grado').value.trim();

      if (!nombre || !grado) {
        alert("Por favor llena todos los campos");
        return;
      }

      const datos = {
        nombre: nombre,
        grado: grado
      };

      const contenidoCifrado = cifrarDatos(datos);
      document.getElementById('qrdata').textContent = contenidoCifrado; // Mostramos el texto cifrado

      const canvas = document.createElement('canvas');
      canvas.id = "qrCanvas";

      document.getElementById('qrcode').innerHTML = ""; // Limpiar antes
      QRCode.toCanvas(canvas, contenidoCifrado, function (error) {
        if (error) {
          alert("Hubo un error al crear el QR: " + error);
        } else {
          document.getElementById('qrcode').appendChild(canvas);
          document.getElementById('descargar').style.display = 'inline-block';
        }
      });
    }

    // Función para descargar el código QR como imagen PNG
    function descargarQR() {
      const canvas = document.getElementById('qrCanvas');
      const enlace = document.createElement('a');
      enlace.download = 'qr_estudiante.png';
      enlace.href = canvas.toDataURL(); // Convertimos el canvas a imagen
      enlace.click();
    }
  </script>
</body>
</html>